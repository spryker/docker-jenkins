name: "Combined CI/CD, Security Scan & Release Notes"

on:
  push:
    branches:
      - master
      - SC-23484-release-notes

jobs:
  # Step 1: CI/CD
  ci-cd:
    uses: ./.github/workflows/ci.yml
    secrets: inherit

  # Step 2: Security Scan
  security-scan:
    needs: ci-cd
    strategy:
      fail-fast: false
      matrix:
        include:
          - image: "2.492.3/Dockerfile"
            tag: "2.492.3"
            platforms: "linux/amd64"
            image_type: "Jenkins"
    
    uses: ./.github/workflows/ecr-scheduled-security-scan.yml
    with:
      image: ${{ matrix.image }}
      tag: ${{ matrix.tag }}
      platforms: ${{ matrix.platforms }}
      image_type: ${{ matrix.image_type }}
      trigger_source: 'workflow'
    secrets: inherit

  # Step 3: Release Notes
  release-notes:
    needs: security-scan
    if: always()
    uses: ./.github/workflows/release-notes.yml
    secrets: inherit